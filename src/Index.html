<!DOCTYPE html>
<html>
<head>
    <base target="_top">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" 
          rel="stylesheet" 
          integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" 
          crossorigin="anonymous">
    <!-- Include external style -->
    <?!= include('style'); ?>
</head>

    <!-- Search Section -->
    <nav class="upper">
    <div class="container-1">
        <div class="row">
            <div class="col">
                <!-- SEARCH FORM -->
                <center>
                    <form id="search-form" onsubmit="handleFormSubmit(this)">
                        <div class="form-group">
                            <h1 style="color:#FDFD95">‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ß‡πá‡∏ö‡πÅ‡∏≠‡∏û‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡πà‡∏ô‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡πÅ‡∏ä‡∏ó‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ‡πÑ‡∏Æ‡∏û‡∏≠‡∏¢‡∏ó‡πå ‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ß‡∏¥‡∏™ ‡πÄ‡∏ô‡πá‡∏ï‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏Ñ (‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢) ‡∏à‡∏≥‡∏Å‡∏±‡∏î</h1>
                            </nav>
                        </div>
                        <p>
                            <div class="col-md-6">
                                <input type="text" class="form-control" id="searchtext" name="searchtext" placeholder="Serach Case ID Here...">
                            </div>
                        </p>
                        <button id="search" type="submit" class="btn btn-success mb-2">Search</button> 
                        <span id="spinner" class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
                    </form>
                </center>
                <!-- SEARCH FORM END -->
            </div>    
        </div>

        <div class="row">
            <div class="col">
                <!-- TABLE OF SEARCH RESULTS -->
                <center><div id="search-results" class="table-responsive">
                    <!-- The Data Table is inserted here by JavaScript -->
                </div>
                <!-- TABLE OF SEARCH RESULTS END -->
            </div>
        </div>
    </div>

    <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß‡∏Ç‡∏≠‡∏á ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ ADMIN -->
    <h1>
        <span style="color:#C1F0B4">‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ ADMIN</span> 
    </h1>

    <!-- Chat Section -->
    <div class="container">
        <!-- Admin controls (hidden by default) -->
        <div id="admin-controls" style="display:none; margin-bottom:10px;">
            <label>
                <input type="checkbox" id="botToggle">
                <span id="botToggleLabel">ü§ñ: ‡∏õ‡∏¥‡∏î</span>
            </label>
        </div>

        <!-- Message container -->
        <div id="message-container"></div>

        <!-- Bottom container (input + send button) -->
        <div class="bottom-container">
            <textarea placeholder="Type a message" id="input-container" cols="30" rows="1"></textarea>
            <button id="sendbtn"> ‡∏™‡πà‡∏á </button>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js" 
            integrity="sha384-q2kxQ16AaE6UbzuKqyBE9/u/KzioAlnx2maXQHiDX9d4/zp8Ok3f+M7DPm+Ib6IU" 
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.min.js" 
            integrity="sha384-pQQkAEnwaBkjpqZ8RU1fF1AKtTcHJwFl3pblpTlHXybJjHpMYo79HY3hIi4NKxyj" 
            crossorigin="anonymous"></script>

    <!-- JavaScript functions -->
    <script>
        // Prevent forms from submitting
        function preventFormSubmit() {
            var forms = document.querySelectorAll('form');
            for (var i = 0; i < forms.length; i++) {
                forms[i].addEventListener('submit', function(event) {
                    event.preventDefault();
                });
            }
        }
        window.addEventListener("load", preventFormSubmit, true); 

        // Send button listener
        const sendbtn = document.getElementById("sendbtn");
        if (sendbtn && !sendbtn.dataset.listenerAdded) {
            sendbtn.addEventListener("click", sendMessage);
            sendbtn.dataset.listenerAdded = "true"; // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô listener ‡∏ã‡πâ‡∏≥
        }

        // Handle form submission
        function handleFormSubmit(formObject) {
            document.getElementById('search').innerHTML = "Loading";
            document.getElementById('spinner').classList.remove("d-none");
            google.script.run.withSuccessHandler(createTable).processForm(formObject);
            document.getElementById("search-form").reset();
        }

        // Create the data table
        function createTable(dataArray) {
            document.getElementById('search').innerHTML = "Search";
            document.getElementById('spinner').classList.add("d-none");

            var div = document.getElementById('search-results');

            if (dataArray && dataArray.length !== 0) {
                var result = "<table class='table table-sm table-striped' id='dtable' style='font-size:0.8em'>" +
                             "<thead style='white-space: nowrap'>" +
                             "<tr>" +
                                "<th scope='col'>CASE</th>" +
                                "<th scope='col'>Serial Number</th>" +
                                "<th scope='col'>Referens Number</th>" +
                                "<th scope='col'>‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏µ‡∏¢</th>" +
                                "<th scope='col'>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>" +
                             "</tr>" +
                             "</thead>";

                for (var i = 0; i < dataArray.length; i++) {
                    result += "<tr>";
                    for (var j = 0; j < dataArray[i].length; j++) {
                        result += "<td>" + dataArray[i][j] + "</td>";
                    }
                    result += "</tr>";
                }
                result += "</table>";
                div.innerHTML = result;
            } else {
                div.innerHTML = "Data not found!";
            }
        }
    </script>
    <?!= include('JavaScript'); ?>
</body>
</html>
